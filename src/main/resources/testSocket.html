<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket STOMP Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webstomp-client/1.0.2/webstomp.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #messages {
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: scroll;
        }
        #input {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>WebSocket STOMP Client</h1>
<div id="messages"></div>
<div id="input">
    <input type="text" id="messageInput" placeholder="Enter message" />
    <button onclick="sendMessage()">Send</button>
</div>

<script>

    const token = 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImF1dGgiOiJVU0VSIiwiaWF0IjoxNzIzMTA2NTAxLCJleHAiOjE5MDMxMDY1MDF9.2D7fp7bhy-DOr2q3o_vp_QAjjjo18rn-pwguYD8i2ck';

    // WebSocket 서버 연결 설정
    const socket = new WebSocket('ws://localhost:8080/ws');
    const stompClient = Stomp.over(socket);

    // WebSocket 연결
    stompClient.connect({'Authorization': token}, (frame) => {
        console.log('Connected: ' + frame);

        // /topic/messages 경로로 메시지 수신
        stompClient.subscribe('/topic/messages', (message) => {
            if (message.body) {
                const messagesDiv = document.getElementById('messages');
                const messageElement = document.createElement('div');
                messageElement.textContent = 'Received message: ' + message.body;
                messagesDiv.appendChild(messageElement);
                messagesDiv.scrollTop = messagesDiv.scrollHeight; // 스크롤을 맨 아래로
            }
        });
    });

    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const messageContent = {
            roomId: '5f176cc5-e620-4b22-b58b-8a5ab8af979a', // 채팅방 ID
            message: messageInput.value // 전송할 메시지
        };

        stompClient.send("/app/send", {'Authorization': token}, JSON.stringify(messageContent));
        messageInput.value = ''; // 입력창 비우기
    }
</script>
</body>
</html>